---
title: "ggplot2 themes"
output:
  rmarkdown::html_vignette:
    css: uikit.css
    toc: yes
vignette: >
  %\VignetteIndexEntry{aa-ggplot2-themes} 
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  comment = "#>",
  fig.width = 7,
  fig.height = 7,
  fig.align = "center"
)
rsconnect <- FALSE
# Copy css from inst
if (FALSE) {
  # devtools::load_all()
  file.copy("inst/css/uikit.css",
            "vignettes", overwrite = TRUE)
  file.copy(list.files("R", pattern = ".R$", full.names = TRUE),
            "vignettes", overwrite = TRUE)  # Avant rsconnect
}
if (rsconnect) {
  invisible(lapply(list.files(".", pattern = ".R$", full.names = TRUE),
         source))
}
```

## Packages
```{r message=FALSE, warning=FALSE}
# library(drealthemes) # Functions are in this package # Uncomment if not rsconnect
library(ggplot2)
library(dplyr)
# Just for rsconnect
library(cowplot)
library(grid)
library(gridExtra)
```

## Thème ggplot

Ce thème peut être défini globalement pour un Rmd ou une application Shiny avec `theme_set(theme_dreal())`. Cependant, créer des zones de couleurs différentes pour le titre ou la _caption_ n'est pas possible de cette manière.

```{r echo=FALSE}
theme_dreal <- function(legend.position = "bottom", ...) {

  # legend.position == "bottom"
  theme_minimal() +
    theme(
      title = element_text(colour = "white", face = "bold"),
      axis.text = element_text(colour = "white", margin = margin(t = 1, r = 50),
                               hjust = 0),
      
      legend.position = legend.position,
      legend.justification = "left",
      legend.background = element_rect(fill = dreal_cols("primary_active"), colour = NA),
      legend.title = element_text(colour = "white", face = "plain"), 
      legend.text = element_text(colour = "white"),
      plot.background = element_rect(fill = dreal_cols("primary_active")),
      panel.background = element_rect(fill = "white"),
      strip.background = element_rect(fill = dreal_cols("primary")),
      
      strip.text = element_text(colour = "white"),
      
      panel.grid.minor = element_blank(),
      panel.grid.major.y = element_line(linetype = "dashed",
                                        colour = dreal_cols("info_light")),
      panel.grid.major.x = element_line(colour = dreal_cols("info_light")),
      ...
    )
  
}

```

```{r}
# directly in a plot
ggplot(mtcars) +
  aes(hp, mpg, colour = as.character(gear)) +
  geom_point(size = 4, alpha = .8) +
  scale_color_dreal_d() +
  ggtitle("Simple graph") +
  labs(caption = "Source: DREAL") +
  theme_dreal()

# facet plot
ggplot(mtcars) +
  aes(hp, mpg, colour = as.character(gear)) +
  geom_point(size = 4, alpha = .8) +
  scale_color_dreal_d() +
  facet_wrap(vars(carb)) +
  ggtitle("Facets graph") +
  labs(caption = "Source: DREAL") +
  theme_dreal()
```

## Thème avec un format _multiplot_

C'est le format le plus proche de la proposition graphique. Cependant, il ne fonctionne pas comme un theme classique. Il nécessite d'ajouter une fonction `drealize` à chaque graphique à la place de l'écriture du titre.

```{r}
# directly in a plot
g <- ggplot(mtcars, aes(hp, mpg, colour = as.character(gear))) +
    geom_point(size = 4, alpha = .8) +
  scale_color_dreal_d()

g2 <- drealize(g, 
         title = "Plot created with drealize()",
         caption = "Source: DREAL",
         legend.position = "bottom")

# ggsave(g2, filename = "g2.png")
# facet plot
# facet plot
g3 <- ggplot(mtcars) +
  aes(hp, mpg, colour = as.character(gear)) +
  geom_point(size = 4, alpha = .8) +
  scale_color_dreal_d() +
  facet_wrap(vars(carb))

drealize(g3, 
         title = "Facet plot created with drealize()",
         caption = "Source: DREAL",
         legend.position = "bottom")

```

Les graphiques avec légende à droite peuvent nécessiter de définir des tailles de sorties des graphs dans un Rmd pour ajuster les ratios

```{r, fig.width=9, fig.height=4}
# Plot with legend on the right
# directly in a plot
g <- ggplot(mtcars, aes(hp, mpg, colour = as.character(gear))) +
    geom_point(size = 4, alpha = .8) +
  scale_color_dreal_d()

drealize(g, 
         title = "Plot created with drealize()",
         caption = "Source: DREAL",
         legend.position = "right")
```

